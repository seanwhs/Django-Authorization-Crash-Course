# âœ… **Django Authorization in 3 Days Crash Course**

*(Trainer-ready, enterprise-grade notes with deep explanations, best practices, and examples)*

These notes are written so they can be used as:

* âœ… Student handbook
* âœ… Trainer slides reference
* âœ… Self-study material
* âœ… Post-course revision guide

---

# ðŸ—“ï¸ **DAY 1: Foundations & User Management**

> *Goal: Understand how identity works in Django and how users are created, stored, and secured.*

---

## âœ… 1. Authentication vs Authorization (CRITICAL CONCEPT)

### ðŸ”¹ Authentication = WHO you are

* Verifies the identity of the user
* Example:

  * Username + Password
  * Email + OTP
  * Token-based login

**In Django:**

* Managed using:

  * `django.contrib.auth`
  * `authenticate()`
  * `login()`

âœ… Example:

```python
from django.contrib.auth import authenticate, login

user = authenticate(username='admin', password='1234')
if user:
    login(request, user)
```

---

### ðŸ”¹ Authorization = WHAT you are allowed to do

* Determines access rights after authentication
* Example:

  * Can user access admin panel?
  * Can user delete records?
  * Can user edit someone else's post?

**In Django:**

* Roles â†’ implemented via Groups
* Permissions â†’ add, change, delete, view

âœ… Example:

```python
request.user.has_perm("blog.delete_post")
```

---

### âœ… Key Exam Difference:

| Feature | Authentication | Authorization  |
| ------- | -------------- | -------------- |
| Purpose | Identity       | Access Control |
| Happens | First          | After login    |
| Example | Login          | Edit/Delete    |

---

## âœ… 2. Django Default User Model

Django ships with:

```python
django.contrib.auth.models.User
```

### ðŸ”¹ Default Fields:

* username
* password (hashed)
* email
* first_name
* last_name
* is_staff
* is_superuser
* is_active
* last_login
* date_joined

âœ… Stored in:

```sql
auth_user
```

---

## âœ… 3. Why Custom User Model is Important

### âŒ Problems with Default User:

* Username is mandatory
* Cannot replace with email easily
* Hard to add business-specific fields

---

### âœ… Use Custom User When:

* You want email login instead of username
* You need roles (admin, editor, member)
* You need phone numbers, departments, etc.

---

## âœ… 4. Custom User Model Options

### âœ… Option 1: `AbstractUser` (Recommended for Most Use Cases)

Extends full Django User with customization

âœ… Example:

```python
from django.contrib.auth.models import AbstractUser
from django.db import models

class CustomUser(AbstractUser):
    role = models.CharField(max_length=20, choices=[
        ("ADMIN", "Admin"),
        ("EDITOR", "Editor"),
        ("VIEWER", "Viewer"),
    ])
    phone_number = models.CharField(max_length=15)
```

âœ… Best for:

* 90% of business applications
* When you want username + password + extra fields

---

### âœ… Option 2: `AbstractBaseUser` (Advanced & Risky)

* Only provides password & authentication logic
* You must implement:

  * username field
  * email
  * manager
  * permissions
  * admin support

âœ… Only use if:

* You fully understand Django internals
* You want email-only login with no username

---

## âœ… 5. Activating a Custom User Model

Inside `settings.py`:

```python
AUTH_USER_MODEL = "accounts.CustomUser"
```

âš ï¸ MUST be set before first migration
âš ï¸ Cannot change after db tables exist without data migration

---

## âœ… 6. Creating Users Programmatically

### âœ… Create Superuser:

```bash
python manage.py createsuperuser
```

---

### âœ… Create User in Code:

```python
from django.contrib.auth import get_user_model

User = get_user_model()
user = User.objects.create_user(
    username="john",
    password="pass1234",
    role="EDITOR"
)
```

---

## âœ… 7. Password Management & Validators

Django stores:
âœ… Hashed passwords only
âŒ Never stores raw passwords

---

### âœ… Default Password Validators:

* Similarity to username
* Minimum length
* Common passwords
* Numeric-only passwords

Enable in `settings.py`:

```python
AUTH_PASSWORD_VALIDATORS = [
    {"NAME": "django.contrib.auth.password_validation.UserAttributeSimilarityValidator"},
    {"NAME": "django.contrib.auth.password_validation.MinimumLengthValidator"},
    {"NAME": "django.contrib.auth.password_validation.CommonPasswordValidator"},
    {"NAME": "django.contrib.auth.password_validation.NumericPasswordValidator"},
]
```

---

## âœ… 8. User Registration Flow (Full Architecture)

Steps:

1. Show registration form
2. Validate input
3. Create user
4. Hash password
5. Auto login OR redirect to login

âœ… Example:

```python
from django.contrib.auth.forms import UserCreationForm

class RegisterForm(UserCreationForm):
    class Meta:
        model = CustomUser
        fields = ["username", "role", "password1", "password2"]
```

---

## âœ… 9. Profile Editing

Two models:

* User â†’ authentication
* Profile â†’ additional info

âœ… Relation:

```python
user = models.OneToOneField(settings.AUTH_USER_MODEL)
```

---

# ðŸ—“ï¸ **DAY 2: Authentication & Permissions**

> *Goal: Control who can access what using permissions & roles.*

---

## âœ… 1. Login & Logout Views

### âœ… Login:

```python
from django.contrib.auth.views import LoginView
```

### âœ… Logout:

```python
from django.contrib.auth.views import LogoutView
```

---

## âœ… 2. Redirect After Login

In `settings.py`:

```python
LOGIN_REDIRECT_URL = "/dashboard/"
LOGOUT_REDIRECT_URL = "/login/"
```

---

## âœ… 3. Django Model Permissions

For every model Django auto-creates:

| Permission | Meaning       |
| ---------- | ------------- |
| add        | Insert record |
| change     | Edit record   |
| delete     | Remove record |
| view       | Read/view     |

Shown in:

```bash
python manage.py migrate
```

---

## âœ… 4. Custom Permissions

Inside model:

```python
class Report(models.Model):
    class Meta:
        permissions = [
            ("approve_report", "Can approve report"),
        ]
```

âœ… Use:

```python
user.has_perm("app.approve_report")
```

---

## âœ… 5. Groups (Django Roles)

Groups = Role Containers

### âœ… Example:

| Group   | Permissions |
| ------- | ----------- |
| Editors | add, change |
| Viewers | view only   |
| Admins  | full        |

âœ… Assign user:

```python
editors = Group.objects.get(name="Editors")
user.groups.add(editors)
```

---

## âœ… 6. View Protection

### âœ… Login Required:

```python
@login_required
```

---

### âœ… Permission Required:

```python
@permission_required("blog.add_post")
```

---

## âœ… 7. Template Authorization

```html
{% if perms.blog.delete_post %}
   <button>Delete</button>
{% endif %}
```

---

# ðŸ—“ï¸ **DAY 3: Advanced Authorization & Security**

> *Goal: Enforce enterprise-grade security and object-level control.*

---

## âœ… 1. Class-Based View Security

### âœ… LoginRequiredMixin

```python
class DashboardView(LoginRequiredMixin, View):
```

---

### âœ… PermissionRequiredMixin

```python
class PostCreateView(PermissionRequiredMixin, CreateView):
    permission_required = "blog.add_post"
```

---

## âœ… 2. Object-Level Permissions

Example Rule:

> Only the author can edit the post

âœ… Using Query Filtering:

```python
Post.objects.filter(author=request.user)
```

âœ… Using Mixin:

```python
class PostUpdateView(UserPassesTestMixin, UpdateView):
    def test_func(self):
        return self.get_object().author == self.request.user
```

---

## âœ… 3. Middleware for Access Control

Middleware intercepts every request:

Use cases:

* Block users by IP
* Restrict admin routes by role
* Force logout suspicious sessions

---

## âœ… 4. Security Best Practices (ENTERPRISE LEVEL)

| Practice               | Why                      |
| ---------------------- | ------------------------ |
| HTTPS                  | Prevent credential theft |
| Secure Cookies         | Prevent session hijack   |
| CSRF Protection        | Prevent form attacks     |
| Disable Debug          | Prevent data leaks       |
| Strong Password Policy | Prevent brute-force      |
| Session Expiry         | Prevent stale logins     |

---

## âœ… 5. DRF Authentication (Optional API Section)

| Type        | Use Case      |
| ----------- | ------------- |
| TokenAuth   | Mobile apps   |
| JWT         | Microservices |
| SessionAuth | Browser APIs  |

---

# âœ… FINAL MINI PROJECT ARCHITECTURE

âœ… Registration/Login
âœ… Custom User with Role
âœ… Groups & Permissions
âœ… Protected Views
âœ… Object-Level Security
âœ… Optional JWT API

---

# âœ… WHAT YOU NOW MASTER

âœ” Authentication & Authorization
âœ” Custom User Models
âœ” Role-Based Access
âœ” Django Permissions
âœ” Class-Based Security
âœ” Object-Level Permissions
âœ” Enterprise Security Standards

